# Quantum Secure Email Client

**Status:** ‚úÖ Ready for Testing | **Version:** 1.0.0

A Windows/Linux desktop email client that integrates Quantum Key Distribution (QKD) with existing email infrastructure (Gmail, Yahoo, etc.) for quantum-secure communications.

---

## üéØ Quick Start

### 1. Install Dependencies

```bash
# Backend
cd backend
pip install -r requirements.txt

# Frontend  
cd quantum-mail-frontend
npm install
```

### 2. Configure Credentials

Create `.env` file in project root:

```env
# Gmail SMTP and IMAP (use App Password!)
SMTP_SERVER=smtp.gmail.com
SMTP_PORT=587
SMTP_USERNAME=your.email@gmail.com
SMTP_PASSWORD=your_app_password_here

IMAP_SERVER=imap.gmail.com
IMAP_PORT=993
IMAP_USERNAME=your.email@gmail.com
IMAP_PASSWORD=your_app_password_here

# QKD Configuration
QKD_KME_URL=http://localhost:8000
QKD_SOURCE_KME_ID=KME_001
QKD_TARGET_KME_ID=KME_002
QKD_KEY_SIZE=32
```

**Get Gmail App Password:** https://myaccount.google.com/apppasswords

### 3. Start Application

```bash
./test_integration.sh
```

This starts:
- QKD Simulator (port 8000)
- Backend API (port 8001)
- Frontend Electron app (port 3000)

### 4. Test

1. Compose an email
2. Select security level (L2 recommended)
3. Send to yourself
4. Click "Inbox" to fetch
5. Click encrypted email to auto-decrypt

---

## üèóÔ∏è Architecture

### Three-Tier System

1. **Frontend** - Electron desktop app (React + Zustand)
2. **Backend** - FastAPI with encryption/email services
3. **QKD Simulator** - Key Management Entity (ETSI GS QKD 014)

### Data Flow

```
User ‚Üí Frontend ‚Üí Backend ‚Üí QKD ‚Üí Encrypt ‚Üí Gmail
                                           ‚Üì
User ‚Üê Frontend ‚Üê Backend ‚Üê QKD ‚Üê Decrypt ‚Üê Gmail
```

See [architecture diagrams](#architecture-diagrams) below.

---

## üîê Security Levels

| Level | Algorithm | Key Source | Use Case | Speed |
|-------|-----------|-----------|----------|-------|
| **L1** | One-Time Pad | QKD | Maximum security | Fast |
| **L2** | AES-256-CFB | QKD | Recommended default | Fastest |
| **L3** | Kyber-512 | PQC | Future-resistant | Medium |
| **L4** | None | N/A | Testing only | Instant |

### Encryption Formats

**L1 (OTP):**
```
ENCRYPTED:L1:[base64_ciphertext]:[key_id]
```

**L2 (AES-CFB):**
```
ENCRYPTED:L2:[base64_iv]:[base64_ciphertext]:[key_id]
```

**L3 (Kyber-512):**  
```
ENCRYPTED:L3:[base64_kyber_ct]:[base64_aes_ct]:[base64_iv]
```

---

## üìÅ Project Structure

```
quantum-email-client/
‚îú‚îÄ‚îÄ .env                       # Email and QKD credentials
‚îú‚îÄ‚îÄ README.md                  # This file
‚îú‚îÄ‚îÄ AGENTS.md                  # Original requirements
‚îú‚îÄ‚îÄ STATUS.md                  # Implementation status
‚îú‚îÄ‚îÄ TESTING.md                 # Detailed testing guide
‚îú‚îÄ‚îÄ test_integration.sh        # Start all services
‚îú‚îÄ‚îÄ stop_services.sh           # Stop all services
‚îú‚îÄ‚îÄ logs/                      # Runtime logs
‚îÇ
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ main.py               # FastAPI with /send, /fetch, /decrypt
‚îÇ   ‚îú‚îÄ‚îÄ encryption.py         # L1/L2/L3/L4 implementations
‚îÇ   ‚îú‚îÄ‚îÄ email_sender.py       # SMTP client
‚îÇ   ‚îú‚îÄ‚îÄ email_receiver.py     # IMAP client
‚îÇ   ‚îú‚îÄ‚îÄ config.py             # Configuration loader
‚îÇ   ‚îú‚îÄ‚îÄ models.py             # Pydantic models
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt      # Python dependencies
‚îÇ
‚îú‚îÄ‚îÄ qkd-simulator/
‚îÇ   ‚îú‚îÄ‚îÄ main.py               # FastAPI QKD service
‚îÇ   ‚îú‚îÄ‚îÄ models.py             # Key models
‚îÇ   ‚îî‚îÄ‚îÄ store_keys.py         # Pre-generate 1000 keys
‚îÇ
‚îî‚îÄ‚îÄ quantum-mail-frontend/
    ‚îú‚îÄ‚îÄ package.json          # npm dependencies
    ‚îú‚îÄ‚îÄ electron/
    ‚îÇ   ‚îú‚îÄ‚îÄ main.js           # Electron entry point
    ‚îÇ   ‚îú‚îÄ‚îÄ preload.js        # IPC security bridge
    ‚îÇ   ‚îî‚îÄ‚îÄ ipc-handlers.js   # Backend API caller
    ‚îî‚îÄ‚îÄ src/
        ‚îú‚îÄ‚îÄ store/
        ‚îÇ   ‚îî‚îÄ‚îÄ useStore.js   # State management
        ‚îî‚îÄ‚îÄ components/
            ‚îú‚îÄ‚îÄ Compose/      # Email composition
            ‚îú‚îÄ‚îÄ Inbox/        # Email list
            ‚îî‚îÄ‚îÄ EmailReader/  # Auto-decrypt display
‚îÇ   ‚îú‚îÄ‚îÄ email_sender.py      # SMTP email sending module
‚îÇ   ‚îú‚îÄ‚îÄ encryption.py        # Encryption functions (placeholders)
‚îÇ   ‚îú‚îÄ‚îÄ models.py            # Pydantic models for API
‚îÇ   ‚îî‚îÄ‚îÄ config.py            # Configuration settings
‚îú‚îÄ‚îÄ qkd-simulator/
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # QKD KME simulator
‚îÇ   ‚îú‚îÄ‚îÄ models.py            # QKD API models
‚îÇ   ‚îî‚îÄ‚îÄ store_keys.py        # In-memory key storage
‚îú‚îÄ‚îÄ requirements.txt         # Python dependencies
‚îî‚îÄ‚îÄ README.md               # This file
```

## Setup Instructions

### Prerequisites

- Python 3.12+
- SMTP server access (Gmail, Yahoo, etc.)
- For Gmail: [App Password](https://support.google.com/accounts/answer/185833) required

### Installation

1. **Clone or navigate to the project directory**:
   ```bash
   cd /home/sasikuttan/dev/crypto/project/quantum-email-client
   ```

2. **Install backend dependencies**:
   ```bash
   pip install -r requirements.txt
   ```

3. **Install frontend dependencies** (if using the Electron app):
   ```bash
   cd quantum-mail-frontend
   npm install
   cd ..
   ```

4. **Configure environment variables** (create a `.env` file or export):
   ```bash
   # SMTP Configuration (Gmail example)
   export SMTP_SERVER="smtp.gmail.com"
   export SMTP_PORT="587"
   export SMTP_USERNAME="your-email@gmail.com"
   export SMTP_PASSWORD="your-app-password"
   export SMTP_USE_TLS="true"
   
   # QKD KME Configuration
   export QKD_KME_URL="http://localhost:8000"
   export QKD_MASTER_SAE_ID="SENDER_SAE"
   export QKD_SLAVE_SAE_ID="RECEIVER_SAE"
   
   # Backend Configuration
   export BACKEND_HOST="0.0.0.0"
   export BACKEND_PORT="8001"
   ```

   **For Gmail Users**: 
   - Enable 2-factor authentication
   - Generate an [App Password](https://myaccount.google.com/apppasswords)
   - Use the app password in `SMTP_PASSWORD`

### Running the Services

**Terminal 1 - Start QKD Simulator (KME)**:
```bash
cd qkd-simulator
python main.py
# Runs on http://localhost:8000
```

**Terminal 2 - Start Email Backend**:
```bash
cd backend
python main.py
# Runs on http://localhost:8001
```

**Terminal 3 - Start Frontend (Optional - Electron App)**:
```bash
cd quantum-mail-frontend
npm start
# Launches the Electron desktop application
```

## API Endpoints

### Backend Service (Port 8001)

#### Health Check
```bash
curl http://localhost:8001/health
```

#### Send Encrypted Email
```bash
curl -X POST http://localhost:8001/send \
  -H "Content-Type: application/json" \
  -d '{
    "from": "sender@gmail.com",
    "to": "recipient@gmail.com",
    "subject": "Quantum Encrypted Test",
    "body": "This is a test of quantum-secure email encryption!",
    "security_level": "L2"
  }'
```

#### Fetch Emails (New!)
```bash
curl -X POST http://localhost:8001/fetch \
  -H "Content-Type: application/json" \
  -d '{
    "folder": "INBOX",
    "limit": 50,
    "unread_only": false
  }'
```

#### Decrypt Email (New!)
```bash
curl -X POST http://localhost:8001/decrypt \
  -H "Content-Type: application/json" \
  -d '{
    "email_id": "email-id-from-fetch",
    "folder": "INBOX"
  }'
```

### QKD Simulator (Port 8000)

#### Get KME Status
```bash
curl http://localhost:8000/api/v1/keys/RECEIVER_SAE/status
```

#### Request Encryption Keys
```bash
curl -X POST http://localhost:8000/api/v1/keys/RECEIVER_SAE/enc_keys \
  -H "Content-Type: application/json" \
  -d '{
    "number": 1,
    "size": 256
  }'
```

## Testing Examples

### Example 1: Send Email with L2 Security (AES-256-GCM)

```bash
curl -X POST http://localhost:8001/send \
  -H "Content-Type: application/json" \
  -d '{
    "from": "your-email@gmail.com",
    "to": "recipient@gmail.com",
    "subject": "Quantum Secure Message - L2",
    "body": "This message is encrypted with quantum-aided AES-256-GCM",
    "security_level": "L2"
  }'
```

**Expected Response**:
```json
{
  "success": true,
  "message": "Email sent successfully with quantum encryption",
  "key_id": "generated-key-id",
  "security_level": "L2",
  "recipient": "recipient@gmail.com"
}
```

### Example 2: Send Email with L1 Security (One-Time Pad)

```bash
curl -X POST http://localhost:8001/send \
  -H "Content-Type: application/json" \
  -d '{
    "from": "your-email@gmail.com",
    "to": "recipient@gmail.com",
    "subject": "Maximum Security Message",
    "body": "This uses one-time pad encryption with QKD keys",
    "security_level": "L1"
  }'
```

### Example 3: Send Email with L3 Security (Post-Quantum)

```bash
curl -X POST http://localhost:8001/send \
  -H "Content-Type: application/json" \
  -d '{
    "from": "your-email@gmail.com",
    "to": "recipient@gmail.com",
    "subject": "Post-Quantum Secure",
    "body": "Protected with Kyber-1024 post-quantum cryptography",
    "security_level": "L3"
  }'
```

### Example 4: Send Plaintext Email (L4 - No Encryption)

```bash
curl -X POST http://localhost:8001/send \
  -H "Content-Type: application/json" \
  -d '{
    "from": "your-email@gmail.com",
    "to": "recipient@gmail.com",
    "subject": "Test Message",
    "body": "This is sent without encryption for testing",
    "security_level": "L4"
  }'
```

## Testing with Python

You can also test using Python's `requests` library:

```python
import requests

payload = {
    "from": "your-email@gmail.com",
    "to": "recipient@gmail.com",
    "subject": "Quantum Test",
    "body": "Testing quantum encryption!",
    "security_level": "L2"
}

response = requests.post(
    "http://localhost:8001/send",
    json=payload
)

print(response.json())
```

## Encrypted Email Format

When you send an encrypted email, the recipient will receive a message in this format:

```
-----BEGIN QUANTUM ENCRYPTED MESSAGE-----
[ENCRYPTED-DATA-HERE]
-----END QUANTUM ENCRYPTED MESSAGE-----

-----BEGIN QUANTUM METADATA-----
{
  "key_id": "key-identifier",
  "security_level": "L2",
  "sender_sae_id": "SENDER_SAE",
  "receiver_sae_id": "RECEIVER_SAE",
  "algorithm_info": "AES-256-GCM (Quantum-aided)"
}
-----END QUANTUM METADATA-----
```

## Configuration Options

All configuration can be set via environment variables:

| Variable | Description | Default |
|----------|-------------|---------|
| `SMTP_SERVER` | SMTP server address | smtp.gmail.com |
| `SMTP_PORT` | SMTP server port | 587 |
| `SMTP_USERNAME` | SMTP authentication username | - |
| `SMTP_PASSWORD` | SMTP authentication password | - |
| `SMTP_USE_TLS` | Use TLS encryption | true |
| `QKD_KME_URL` | QKD KME service URL | http://localhost:8000 |
| `QKD_MASTER_SAE_ID` | Sender SAE identifier | SENDER_SAE |
| `QKD_SLAVE_SAE_ID` | Receiver SAE identifier | RECEIVER_SAE |
| `BACKEND_HOST` | Backend listen address | 0.0.0.0 |
| `BACKEND_PORT` | Backend listen port | 8001 |

## Troubleshooting

### Gmail Authentication Issues

If you get "Username and Password not accepted":
1. Enable 2-factor authentication on your Google account
2. Generate an App Password at https://myaccount.google.com/apppasswords
3.**NEW: IMAP receiver for fetching emails**
- **NEW: `/fetch` endpoint for retrieving emails from IMAP**
- **NEW: `/decrypt` endpoint for decrypting received emails**
- **NEW: Full encryption/decryption implementations (OTP, AES-CFB, Kyber-512)**
- Multi-level security support (L1-L4)
- SMTP integration with major providers
- Configuration management
- **NEW: Frontend-backend integration via Electron IPC**
- **NEW: Quantum-mail-frontend Electron app**

### üöß Pending Implementation
- ~~Actual cryptographic implementations~~ ‚úÖ DONE
- ~~IMAP receiver for reading encrypted emails~~ ‚úÖ DONE
- ~~Message decryption functionality~~ ‚úÖ DONE
- Enhanced attachment handling
- Key lifecycle management and cleanup
- Complete frontend email reading functionality
- Settings synchronization

Change the port in environment variables:
```bash
export BACKEND_PORT="8002"
```

## Development Status

### ‚úÖ Completed
- QKD KME simulator with ETSI-style APIs
- Backend FastAPI service with `/send` endpoint
- Multi-level security support (L1-L4)
- SMTP integration with major providers
- Configuration management

### üöß Pending Implementation
- Actual cryptographic implementations (currently placeholders)
- IMAP receiver for reading encrypted emails
- Message decryption functionality
- GUI frontend (Windows desktop client)
- Key synchronization between sender and receiver

## Security Levels Detail

| Level | Method | Security | Performance | Use Case |
|-------|--------|----------|-------------|----------|
| L1 | One-Time Pad | Maximum (theoretical) | Low (key = data length) | Ultra-sensitive data |
| L2 | AES-256-GCM + QKD | Very High | High | Default for most use |
| L3 | Kyber-1024 PQC | High (quantum-resistant) | Medium | Future-proofing |
| L4 | None | None | Maximum | Testing/debugging |

## API Documentation

Once the backend is running, visit:
- **Swagger UI**: http://localhost:8001/docs
- **ReDoc**: http://localhost:8001/redoc

## Next Steps

1. **Implement actual encryption**: Replace placeholder functions in `backend/encryption.py`
2. **Build IMAP receiver**: Create module to fetch and decrypt emails
3. **Develop GUI**: Windows desktop application for user interface
4. **Key Management**: Implement proper key lifecycle and cleanup
5. **Testing**: Add unit tests and integration tests

## License

[Your License Here]

## Contributors

[Your Name/Team]

---

For questions or issues, please refer to the `AGENTS.md` file for architectural details.
